<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" />
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style type="text/css">
        #map {
            height: calc(100vh - 200px);
            width: 100%;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <h1>Golden For Congress</h1>
        <div id="map"></div>
        <script>
            var map = {};

            function initMap() {
                var drawing = false;
                var snapToRoads = false;

                var directionsService = new google.maps.DirectionsService();
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 9,
                    center: { "lat": 42.6, "lng": -78.1 }
                });

                axios.get('district-high.json')
                    .then(function (response) {
                        var district = new google.maps.Polygon({
                            map: map,
                            paths: response.data,
                            strokeColor: '#00F',
                            strokeOpacity: 0.4,
                            strokeWeight: 0.4,
                            fillColor: '#00F',
                            fillOpacity: 0.04,
                            clickable: false
                        });
                        var bounds = new google.maps.LatLngBounds();
                        response.data.forEach(function (point) {
                            bounds.extend(point);
                        }, this);
                        map.fitBounds(bounds);
                    });

                axios.get('route.json')
                    .then(function (response) {
                        response.data.forEach(function (day) {
                            var info = new google.maps.InfoWindow({
                                content: "<h4>Day " + day.day + "</h4>"
                                + "<b>" + day.date + "</b>"
                                + day.description
                            });
                            var line = new google.maps.Polyline({
                                map: map,
                                strokeColor: day.color,
                                path: day.path
                            });
                            line.addListener('click', function (e) {
                                info.open(map, line);
                                info.setPosition(e.latLng, e.latLng);
                            });
                        });
                    });

                if (drawing) {
                    var drawingManager = new google.maps.drawing.DrawingManager({
                        map: map,
                        drawingMode: google.maps.drawing.OverlayType.POLYLINE,
                        drawingControl: false
                    });
                    google.maps.event.addListener(drawingManager, 'polylinecomplete', function (line) {
                        if (snapToRoads) {
                            var path = [];
                            var waypoints = [];
                            var linePath = line.getPath();
                            for (n = 1; n < linePath.getLength() - 1; n++) {
                                waypoints.push({ "location": linePath.getAt(n) });
                            }
                            directionsService.route({
                                origin: linePath.getAt(0),
                                destination: linePath.getAt(n),
                                waypoints: waypoints,
                                travelMode: google.maps.DirectionsTravelMode.WALKING
                            }, function (result, status) {
                                if (status == google.maps.DirectionsStatus.OK) {
                                    for (var i = 0, len = result.routes[0].overview_path.length; i < len; i++) {
                                        path.push(result.routes[0].overview_path[i]);
                                    }
                                }
                                console.log(JSON.stringify(path));
                                line.setPath(path);
                            });
                        } else {
                            console.log(JSON.stringify(line.getPath().getArray()));
                        }
                    });
                }
            }
        </script>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5BLzWoz9YN6LB5I0JfQzGZL4jXmqB8y4&libraries=drawing&callback=initMap"></script>
    </div>
</body>

</html>